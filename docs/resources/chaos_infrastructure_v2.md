---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "harness_chaos_infrastructure_v2 Resource - terraform-provider-harness"
subcategory: "Next Gen"
description: |-
  Resource for managing Harness Chaos Infrastructure V2.
---

# harness_chaos_infrastructure_v2 (Resource)

Resource for managing Harness Chaos Infrastructure V2.

## Example Usage

```terraform
// Create a new chaos infrastructure with minimal configuration
resource "harness_chaos_infrastructure_v2" "test" {
  # Required fields
  org_id         = "<org_id>"
  project_id     = "<project_id>"
  environment_id = "<environment_id>"
  infra_id       = "<infra_id>"
  name           = "<name>"
  description    = "<description>"
}

// Create a new chaos infrastructure with full configuration
resource "harness_chaos_infrastructure_v2" "test" {
  # Required fields
  org_id         = "<org_id>"
  project_id     = "<project_id>"
  environment_id = "<environment_id>"
  infra_id       = "<infra_id>"

  # Optional fields
  name         = "<name>"
  # Expected to be a numeric group ID
  run_as_group = "<run_as_group>"
  run_as_user  = "<run_as_user>"

  description     = "<description>"
  service_account = "<service_account>"
  namespace       = "<namespace>"
  infra_type      = "<infra_type>"

  ai_enabled           = "<ai_enabled>"
  insecure_skip_verify = "<insecure_skip_verify>"

  # Example of node selector
  node_selector = {
    "kubernetes.io/os"   = "linux"
    "kubernetes.io/arch" = "amd64"
  }

  # Example of labels
  label = {
    "label_key" = "<label_value>"
  }

  # Example of annotations
  annotation = {
    "annotation_key" = "<annotation_value>"
  }

  # Example of volumes
  volumes {
    name       = "test-volume"
    size_limit = "1Gi"
  }

  # Example of volume mounts
  volume_mounts {
    name              = "test-volume"
    mount_path        = "/data"
    read_only         = false
    mount_propagation = "None"
  }

  # Example of environment variables
  env {
    name  = "ENV_VAR"
    value = "test-value"
  }

  # Example of tolerations
  tolerations {
    key                = "key1"
    operator           = "Equal"
    value              = "value1"
    effect             = "NoSchedule"
    toleration_seconds = 3600
  }

  mtls {
    cert_path   = "/etc/certs/tls.crt"
    key_path    = "/etc/certs/tls.key"
    secret_name = "mtls-secret"
    url         = "https://mtls.example.com:8443"
  }

  proxy {
    http_proxy  = "http://proxy.example.com:8080"
    https_proxy = "https://proxy.example.com:8080"
    no_proxy    = "localhost,127.0.0.1,.svc,.cluster.local"
    url         = "https://proxy.example.com"
  }

  image_registry {
    registry_account    = "<registry_account>"
    registry_server     = "<registry_server>"
    secret_name         = "<secret_name>"
    is_override_allowed = true
    is_default          = false
    is_private          = true
    use_custom_images   = true

    custom_images {
      ddcr        = "<ddcr_image>"
      ddcr_fault  = "<ddcr_fault_image>"
      ddcr_lib    = "<ddcr_lib_image>"
      log_watcher = "<log_watcher_image>"
    }
  }
  containers = "<containers>"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `environment_id` (String) The ID of the environment.
- `infra_id` (String) ID of the infrastructure.
- `name` (String) Name of the infrastructure.
- `org_id` (String) The ID of the organization.
- `project_id` (String) The ID of the project.

### Optional

- `ai_enabled` (Boolean) Enable AI features for the infrastructure.
- `annotation` (Map of String) Annotations to apply to the infrastructure pods.
- `containers` (String) Container configurations.
- `correlation_id` (String) Correlation ID for the request.
- `description` (String) Description of the infrastructure.
- `discovery_agent_id` (String) ID of the discovery agent to use.
- `env` (Block List) List of environment variables to set in the container. (see [below for nested schema](#nestedblock--env))
- `image_registry` (Block List) Configuration for the container image registry. (see [below for nested schema](#nestedblock--image_registry))
- `infra_scope` (String) Scope of the infrastructure. Valid values: NAMESPACE, CLUSTER
- `infra_type` (String) Type of the infrastructure. Valid values: KUBERNETES, KUBERNETESV2
- `insecure_skip_verify` (Boolean) Skip TLS verification for the infrastructure.
- `label` (Map of String) Labels to apply to the infrastructure pods.
- `mtls` (Block List, Max: 1) mTLS configuration for the infrastructure. (see [below for nested schema](#nestedblock--mtls))
- `namespace` (String) Kubernetes namespace where the infrastructure will be installed. Maps to the infrastructure namespace.
- `node_selector` (Map of String) Node selector for the infrastructure pods.
- `proxy` (Block List, Max: 1) Proxy configuration for the infrastructure. (see [below for nested schema](#nestedblock--proxy))
- `run_as_group` (Number) Group ID to run the infrastructure as.
- `run_as_user` (Number) User ID to run the infrastructure as.
- `service_account` (String) Service account used by the infrastructure.
- `tags` (List of String) Tags for the infrastructure.
- `tolerations` (Block List) If specified, the pod's tolerations. (see [below for nested schema](#nestedblock--tolerations))
- `volume_mounts` (Block List) Volume mounts for the container. (see [below for nested schema](#nestedblock--volume_mounts))
- `volumes` (Block List) Volumes to be created in the infrastructure. (see [below for nested schema](#nestedblock--volumes))

### Read-Only

- `created_at` (String) Creation timestamp.
- `id` (String) The ID of this resource.
- `identifier` (List of Object) Identifier for the infrastructure. (see [below for nested schema](#nestedatt--identifier))
- `identity` (String) Identity for the infrastructure.
- `infra_namespace` (String) Namespace where the infrastructure is installed.
- `install_command` (String) Installation command for the infrastructure.
- `k8s_connector_id` (String) Kubernetes connector identifier.
- `status` (String) Status of the infrastructure.
- `updated_at` (String) Last update timestamp.

<a id="nestedblock--env"></a>
### Nested Schema for `env`

Required:

- `name` (String) Name of the environment variable. Must be a C_IDENTIFIER.

Optional:

- `key` (String) Variable name from a ConfigMap or Secret. Required when value_from is configMapKeyRef or secretKeyRef.
- `value` (String) Variable references $(VAR_NAME) are expanded using the container's environment. If the variable cannot be resolved, the reference in the input string will be unchanged. The $(VAR_NAME) syntax can be escaped with a double $$, ie: $$(VAR_NAME). Escaped references will never be expanded, regardless of whether the variable exists or not. Defaults to "".
- `value_from` (String) Source for the environment variable's value. Cannot be used if value is not empty.


<a id="nestedblock--image_registry"></a>
### Nested Schema for `image_registry`

Optional:

- `custom_images` (Block List) Custom image configurations. Required when use_custom_images is true. (see [below for nested schema](#nestedblock--image_registry--custom_images))
- `is_default` (Boolean) Whether this is the default registry.
- `is_override_allowed` (Boolean) Whether override is allowed for this registry.
- `is_private` (Boolean) Whether the registry is private.
- `registry_account` (String) The account name for the container registry.
- `registry_server` (String) The container image registry server URL (e.g., docker.io, gcr.io).
- `secret_name` (String) Name of the Kubernetes secret containing registry credentials.
- `use_custom_images` (Boolean) Whether to use custom images instead of default ones.

Read-Only:

- `created_at` (String) Timestamp when the registry was created.
- `identifier` (List of Object) Scoped identifiers for the registry. (see [below for nested schema](#nestedatt--image_registry--identifier))
- `infra_id` (String) ID of the infrastructure.
- `updated_at` (String) Timestamp when the registry was last updated.

<a id="nestedblock--image_registry--custom_images"></a>
### Nested Schema for `image_registry.custom_images`

Optional:

- `ddcr` (String) Custom image for ddcr.
- `ddcr_fault` (String) Custom image for ddcr-fault.
- `ddcr_lib` (String) Custom image for ddcr-lib.
- `log_watcher` (String) Custom image for log-watcher.


<a id="nestedatt--image_registry--identifier"></a>
### Nested Schema for `image_registry.identifier`

Read-Only:

- `account_identifier` (String)
- `org_identifier` (String)
- `project_identifier` (String)



<a id="nestedblock--mtls"></a>
### Nested Schema for `mtls`

Optional:

- `cert_path` (String) Path to the certificate file for mTLS
- `key_path` (String) Path to the private key file for mTLS
- `secret_name` (String) Name of the Kubernetes secret containing mTLS certificates
- `url` (String) URL for the mTLS endpoint


<a id="nestedblock--proxy"></a>
### Nested Schema for `proxy`

Required:

- `url` (String) Proxy URL.

Optional:

- `http_proxy` (String) HTTP proxy URL.
- `https_proxy` (String) HTTPS proxy URL.
- `no_proxy` (String) List of hosts that should not use proxy.


<a id="nestedblock--tolerations"></a>
### Nested Schema for `tolerations`

Required:

- `effect` (String) Effect indicates the taint effect to match. When specified, allowed values are NoSchedule, PreferNoSchedule and NoExecute.
- `key` (String) Key is the taint key that the toleration applies to. Empty means match all taint keys. If the key is empty, operator must be Exists.
- `operator` (String) Operator represents a key's relationship to the value. Valid operators are Exists and Equal. Defaults to Equal.

Optional:

- `toleration_seconds` (Number) TolerationSeconds represents the period of time the toleration (which must be of effect NoExecute, otherwise this field is ignored) tolerates the taint. By default, it is not set, which means tolerate the taint forever (do not evict). Zero and negative values will be treated as 0 (evict immediately) by the system.
- `value` (String) Value is the taint value the toleration matches to. If the operator is Exists, the value should be empty, otherwise just a regular string.


<a id="nestedblock--volume_mounts"></a>
### Nested Schema for `volume_mounts`

Required:

- `mount_path` (String) Path within the container at which the volume should be mounted. Must not contain ':'.
- `name` (String) This must match the Name of a Volume.

Optional:

- `mount_propagation` (String) Determines how mounts are propagated from the host to container and the other way around. When not set, MountPropagationNone is used.
- `read_only` (Boolean) Mounted read-only if true, read-write otherwise.
- `sub_path` (String) Path within the volume from which the container's volume should be mounted. Mutually exclusive with sub_path_expr.
- `sub_path_expr` (String) Expanded path within the volume from which the container's volume should be mounted. Behaves similarly to sub_path but environment variable references $(VAR_NAME) are expanded using the container's environment. Mutually exclusive with sub_path.


<a id="nestedblock--volumes"></a>
### Nested Schema for `volumes`

Required:

- `name` (String) Name of the volume. Must be a DNS_LABEL and unique within the pod.

Optional:

- `size_limit` (String) Size limit of the volume. Example: '10Gi', '100Mi'


<a id="nestedatt--identifier"></a>
### Nested Schema for `identifier`

Read-Only:

- `account_identifier` (String)
- `org_identifier` (String)
- `project_identifier` (String)

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
# Import Project level Chaos Infrastructure v2
terraform import harness_chaos_infrastructure_v2.example <org_id>/<project_id>/<environment_id>/<infra_id>
```
