---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "harness_service_discovery_agent Resource - terraform-provider-harness"
subcategory: "Next Gen"
description: |-
  Resource for managing a Harness Service Discovery Agent.
  This resource allows you to create, read, update, and delete a Service Discovery Agent in Harness.
  Example Usage
  
  resource "harness_service_discovery_agent" "example" {
    name                   = "ExampleAgent"
    org_identifier         = "your_org_id"
    project_identifier     = "your_project_id"
    environment_identifier = "your_environment_id"
    infra_identifier       = "your_infra_id"
    
    config {
      collector_image    = "harness/service-discovery-collector:main-latest"
      log_watcher_image  = "harness/chaos-log-watcher:main-latest"
      
      kubernetes {
        namespace = "harness-sd"
      }
    }
  }
---

# harness_service_discovery_agent (Resource)

Resource for managing a Harness Service Discovery Agent.

This resource allows you to create, read, update, and delete a Service Discovery Agent in Harness.

## Example Usage

```hcl
resource "harness_service_discovery_agent" "example" {
  name                   = "ExampleAgent"
  org_identifier         = "your_org_id"
  project_identifier     = "your_project_id"
  environment_identifier = "your_environment_id"
  infra_identifier       = "your_infra_id"
  
  config {
    collector_image    = "harness/service-discovery-collector:main-latest"
    log_watcher_image  = "harness/chaos-log-watcher:main-latest"
    
    kubernetes {
      namespace = "harness-sd"
    }
  }
}
```

## Example Usage

```terraform
// Create a new service discovery agent with minimal configuration
resource "harness_service_discovery_agent" "example" {
  name                   = "example-agent"
  org_identifier         = var.org_identifier
  project_identifier     = var.project_identifier
  environment_identifier = var.environment_identifier
  infra_identifier       = "example-infra"

  config {
    kubernetes {
      namespace = "harness-sd"
    }
  }
}

// Create a new service discovery agent with node agent enabled
resource "harness_service_discovery_agent" "node_agent" {
  name                   = "node-agent-example"
  org_identifier         = var.org_identifier
  project_identifier     = var.project_identifier
  environment_identifier = var.environment_identifier
  infra_identifier       = "node-agent-example"

  config {
    kubernetes {
      namespace = "harness-sd"
    }

    data {
      enable_node_agent = true
    }
  }
}


// Create a new service discovery agent with full configuration
resource "harness_service_discovery_agent" "full_config" {
  name                   = "full-config-example"
  org_identifier         = var.org_identifier
  project_identifier     = var.project_identifier
  environment_identifier = var.environment_identifier
  infra_identifier       = "full-config-example"
  permanent_installation = false
  correlation_id         = "full-config-correlation-123"

  config {
    collector_image    = "harness/service-discovery-collector:main-latest"
    log_watcher_image  = "harness/chaos-log-watcher:main-latest"
    skip_secure_verify = false

    kubernetes {
      namespace         = "harness-sd"
      service_account   = "harness-sd-sa"
      image_pull_policy = "IfNotPresent"
      run_as_user       = 2000
      run_as_group      = 2000

      labels = {
        "app" = "service-discovery"
        "env" = "dev"
      }

      annotations = {
        "example.com/annotation" = "value"
      }

      node_selector = {
        "kubernetes.io/os" = "linux"
      }

      resources {
        limits = {
          cpu    = "500m"
          memory = "512Mi"
        }
        requests = {
          cpu    = "250m"
          memory = "256Mi"
        }
      }

      tolerations {
        key      = "key1"
        operator = "Equal"
        value    = "value1"
        effect   = "NoSchedule"
      }
    }

    data {
      enable_node_agent        = true
      node_agent_selector      = "node-role.kubernetes.io/worker="
      enable_batch_resources   = true
      enable_orphaned_pod      = true
      namespace_selector       = "environment=dev"
      collection_window_in_min = 15

      blacklisted_namespaces = ["kube-system", "kube-public"]
      observed_namespaces    = ["default", "harness"]

      cron {
        expression = "0/10 * * * *"
      }
    }

    mtls {
      cert_path   = "/etc/certs/tls.crt"
      key_path    = "/etc/certs/tls.key"
      secret_name = "mtls-secret"
      url         = "https://mtls.example.com:8443"
    }

    proxy {
      http_proxy  = "http://proxy.example.com:8080"
      https_proxy = "https://proxy.example.com:8080"
      no_proxy    = "localhost,127.0.0.1,.svc,.cluster.local"
      url         = "https://proxy.example.com"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `config` (Block List, Min: 1) Configuration for the agent. This is a required field. (see [below for nested schema](#nestedblock--config))
- `environment_identifier` (String) The environment identifier of the agent. This is a required field.
- `infra_identifier` (String) The infrastructure identifier of the agent. This is a required field.
- `name` (String) The name of the agent. This is a required field.

### Optional

- `correlation_id` (String) Correlation ID for the agent.
- `installation_type` (String) Type of installation for the agent.
- `org_identifier` (String) The organization identifier of the agent. Must be 1-64 characters and contain only alphanumeric characters, hyphens, or underscores.
- `permanent_installation` (Boolean) Whether this is a permanent installation.
- `project_identifier` (String) The project identifier of the agent. Must be 1-64 characters and contain only alphanumeric characters, hyphens, or underscores.
- `webhook_url` (String) Webhook URL for the agent.

### Read-Only

- `created_at` (String) Timestamp when the agent was created.
- `created_by` (String) User who created the agent.
- `description` (String) Description of the agent.
- `id` (String) The unique identifier of the agent.
- `identity` (String) The unique identity of the agent.
- `installation_details` (List of Object) Installation details of the agent. (see [below for nested schema](#nestedatt--installation_details))
- `network_map_count` (Number) Number of network maps associated with this agent.
- `removed` (Boolean) Whether the agent has been removed.
- `removed_at` (String) Timestamp when the agent was removed.
- `service_count` (Number) Number of services managed by this agent.
- `tags` (List of String) List of resource tags for the agent.
- `updated_at` (String) Timestamp when the agent was last updated.
- `updated_by` (String) User who last updated the agent.

<a id="nestedblock--config"></a>
### Nested Schema for `config`

Required:

- `kubernetes` (Block List, Min: 1) Kubernetes-specific configuration. (see [below for nested schema](#nestedblock--config--kubernetes))

Optional:

- `collector_image` (String) Docker image for the collector.
- `data` (Block List) Data collection configuration. (see [below for nested schema](#nestedblock--config--data))
- `image_pull_secrets` (List of String) List of image pull secrets.
- `log_watcher_image` (String) Docker image for the log watcher.
- `mtls` (Block List) mTLS configuration. (see [below for nested schema](#nestedblock--config--mtls))
- `proxy` (Block List) Proxy configuration. (see [below for nested schema](#nestedblock--config--proxy))
- `skip_secure_verify` (Boolean) Whether to skip TLS verification.

<a id="nestedblock--config--kubernetes"></a>
### Nested Schema for `config.kubernetes`

Required:

- `namespace` (String) Kubernetes namespace to use

Optional:

- `annotations` (Map of String) Annotations to add to all resources.
- `disable_namespace_creation` (Boolean) Whether to disable namespace creation.
- `image_pull_policy` (String) The image pull policy.
- `labels` (Map of String) Labels to add to all resources.
- `namespaced` (Boolean) Whether the agent is namespaced.
- `node_selector` (Map of String) Node selector labels.
- `resources` (Block List) Compute resource requirements for the agent container. (see [below for nested schema](#nestedblock--config--kubernetes--resources))
- `run_as_group` (Number) The group ID to run as.
- `run_as_user` (Number) The user ID to run as.
- `service_account` (String) Service account to use
- `tolerations` (Block List) Tolerations for pod assignment. (see [below for nested schema](#nestedblock--config--kubernetes--tolerations))

<a id="nestedblock--config--kubernetes--resources"></a>
### Nested Schema for `config.kubernetes.resources`

Optional:

- `limits` (Block List) Maximum amount of compute resources allowed. (see [below for nested schema](#nestedblock--config--kubernetes--resources--limits))
- `requests` (Block List) Minimum amount of compute resources required. (see [below for nested schema](#nestedblock--config--kubernetes--resources--requests))

<a id="nestedblock--config--kubernetes--resources--limits"></a>
### Nested Schema for `config.kubernetes.resources.limits`

Optional:

- `cpu` (String) CPU limit in CPU units (e.g., 500m = 0.5 CPU, 2 = 2 CPUs).
- `memory` (String) Memory limit in bytes (e.g., 128Mi, 1Gi).


<a id="nestedblock--config--kubernetes--resources--requests"></a>
### Nested Schema for `config.kubernetes.resources.requests`

Optional:

- `cpu` (String) CPU request in CPU units (e.g., 100m = 0.1 CPU).
- `memory` (String) Memory request in bytes (e.g., 128Mi, 1Gi).



<a id="nestedblock--config--kubernetes--tolerations"></a>
### Nested Schema for `config.kubernetes.tolerations`

Required:

- `effect` (String) Effect indicates the taint effect to match.
- `key` (String) The taint key that the toleration applies to.
- `operator` (String) Operator represents a key's relationship to the value.

Optional:

- `toleration_seconds` (Number) TolerationSeconds represents the period of time the toleration tolerates the taint.
- `value` (String) The taint value the toleration matches to.



<a id="nestedblock--config--data"></a>
### Nested Schema for `config.data`

Optional:

- `blacklisted_namespaces` (List of String) List of namespaces to exclude from discovery.
- `collection_window_in_min` (Number) Collection window in minutes.
- `cron` (Block List) Cron schedule for data collection. (see [below for nested schema](#nestedblock--config--data--cron))
- `enable_batch_resources` (Boolean) Whether to enable batch resources.
- `enable_node_agent` (Boolean) Whether to enable node agent.
- `enable_orphaned_pod` (Boolean) Whether to enable orphaned pod detection.
- `namespace_selector` (String) Namespace selector for the agent.
- `node_agent_selector` (String) Node selector for the node agent.
- `observed_namespaces` (List of String) List of namespaces to observe.

<a id="nestedblock--config--data--cron"></a>
### Nested Schema for `config.data.cron`

Optional:

- `expression` (String) Cron expression for scheduling.



<a id="nestedblock--config--mtls"></a>
### Nested Schema for `config.mtls`

Optional:

- `cert_path` (String) Path to the certificate file.
- `key_path` (String) Path to the key file.
- `secret_name` (String) Name of the Kubernetes secret containing the certificate and key.
- `url` (String) URL of the mTLS server.


<a id="nestedblock--config--proxy"></a>
### Nested Schema for `config.proxy`

Optional:

- `http_proxy` (String) HTTP proxy URL.
- `https_proxy` (String) HTTPS proxy URL.
- `no_proxy` (String) Comma-separated list of hosts that should not use the proxy.
- `url` (String) Proxy server URL.



<a id="nestedatt--installation_details"></a>
### Nested Schema for `installation_details`

Read-Only:

- `account_identifier` (String)
- `agent_details` (List of Object) (see [below for nested schema](#nestedobjatt--installation_details--agent_details))
- `agent_id` (String)
- `created_at` (String)
- `created_by` (String)
- `delegate_id` (String)
- `delegate_task_id` (String)
- `delegate_task_status` (String)
- `environment_identifier` (String)
- `id` (String)
- `is_cron_triggered` (Boolean)
- `log_stream_created_at` (String)
- `log_stream_id` (String)
- `organization_identifier` (String)
- `project_identifier` (String)
- `removed` (Boolean)
- `stopped` (Boolean)
- `updated_at` (String)
- `updated_by` (String)

<a id="nestedobjatt--installation_details--agent_details"></a>
### Nested Schema for `installation_details.agent_details`

Read-Only:

- `cluster` (List of Object) (see [below for nested schema](#nestedobjatt--installation_details--agent_details--cluster))
- `status` (String)

<a id="nestedobjatt--installation_details--agent_details--cluster"></a>
### Nested Schema for `installation_details.agent_details.cluster`

Read-Only:

- `name` (String)
- `namespace` (String)
- `status` (String)
- `uid` (String)

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
# Import Project level Service Discovery Agent
# Account and Org level agents are not supported yet
terraform import harness_service_discovery_agent.example <org_identifier>/<project_identifier>/<environment_identifier>/<infra_identifier>
```
