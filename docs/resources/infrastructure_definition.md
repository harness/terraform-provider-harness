---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "harness_infrastructure_definition Resource - terraform-provider-harness"
subcategory: "First Gen"
description: |-
  Resource for creating am infrastructure definition. This resource uses the config-as-code API's. When updating the name or path of this resource you should typically also set the create_before_destroy = true lifecycle setting.
---

# harness_infrastructure_definition (Resource)

Resource for creating am infrastructure definition. This resource uses the config-as-code API's. When updating the `name` or `path` of this resource you should typically also set the `create_before_destroy = true` lifecycle setting.

## Example Usage

```terraform
# Creating a Kubernetes infrastructure definition

resource "harness_cloudprovider_kubernetes" "dev" {
  name = "k8s-dev"

  authentication {
    delegate_selectors = ["k8s"]
  }
}

resource "harness_application" "example" {
  name = "example"
}

resource "harness_environment" "dev" {
  name   = "dev"
  app_id = harness_application.example.id
  type   = "NON_PROD"
}

# Creating a infrastructure of type KUBERNETES
resource "harness_infrastructure_definition" "k8s" {
  name                = "k8s-eks-us-east-1"
  app_id              = harness_application.example.id
  env_id              = harness_environment.dev.id
  cloud_provider_type = "KUBERNETES_CLUSTER"
  deployment_type     = "KUBERNETES"

  kubernetes {
    cloud_provider_name = harness_cloudprovider_kubernetes.dev.name
    namespace           = "dev"
    release_name        = "$${service.name}"
  }
}

# Creating a Deployment Template for CUSTOM infrastructure type
resource "harness_yaml_config" "example_yaml" {
  path    = "Setup/Template Library/Example Folder/deployment_template.yaml"
  content = <<EOF
harnessApiVersion: '1.0'
type: CUSTOM_DEPLOYMENT_TYPE
fetchInstanceScript: |-
  set -ex
  curl http://$${url}/$${file_name} > $${INSTANCE_OUTPUT_PATH}
hostAttributes:
  hostname: host
hostObjectArrayPath: hosts
variables:
- name: url
- name: file_name
EOF
}

# Creating a infrastructure of type CUSTOM
resource "harness_infrastructure_definition" "custom" {
  name                    = "custom-infra"
  app_id                  = harness_application.example.id
  env_id                  = harness_environment.dev.id
  cloud_provider_type     = "CUSTOM"
  deployment_type         = "CUSTOM"
  deployment_template_uri = "Example Folder/${harness_yaml_config.example_yaml.name}"

  custom {
    deployment_type_template_version = "1"
    variable {
      name  = "url"
      value = "localhost:8081"
    }

    variable {
      name  = "file_name"
      value = "instances.json"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `app_id` (String) The id of the application the infrastructure definition belongs to.
- `cloud_provider_type` (String) The type of the cloud provider to connect with. Valid options are AWS, AZURE, CUSTOM, PHYSICAL_DATA_CENTER, KUBERNETES_CLUSTER, PCF, SPOT_INST
- `deployment_type` (String) The type of the deployment to use. Valid options are AMI, AWS_CODEDEPLOY, AWS_LAMBDA, AZURE_VMSS, AZURE_WEBAPP, CUSTOM, ECS, HELM, KUBERNETES, PCF, SSH, WINRM
- `env_id` (String) The id of the environment the infrastructure definition belongs to.
- `name` (String) The name of the infrastructure definition

### Optional

- `aws_ami` (Block List, Max: 1) The configuration details for Aws AMI deployments. (see [below for nested schema](#nestedblock--aws_ami))
- `aws_ecs` (Block List, Max: 1) The configuration details for Aws AMI deployments. (see [below for nested schema](#nestedblock--aws_ecs))
- `aws_lambda` (Block List, Max: 1) The configuration details for Aws Lambda deployments. (see [below for nested schema](#nestedblock--aws_lambda))
- `aws_ssh` (Block List, Max: 1) The configuration details for AWS SSH deployments. (see [below for nested schema](#nestedblock--aws_ssh))
- `aws_winrm` (Block List, Max: 1) The configuration details for AWS WinRM deployments. (see [below for nested schema](#nestedblock--aws_winrm))
- `azure_vmss` (Block List, Max: 1) The configuration details for Azure VMSS deployments. (see [below for nested schema](#nestedblock--azure_vmss))
- `azure_webapp` (Block List, Max: 1) The configuration details for Azure WebApp deployments. (see [below for nested schema](#nestedblock--azure_webapp))
- `custom` (Block List, Max: 1) The configuration details for Custom deployments. (see [below for nested schema](#nestedblock--custom))
- `datacenter_ssh` (Block List, Max: 1) The configuration details for SSH datacenter deployments. (see [below for nested schema](#nestedblock--datacenter_ssh))
- `datacenter_winrm` (Block List, Max: 1) The configuration details for WinRM datacenter deployments. (see [below for nested schema](#nestedblock--datacenter_winrm))
- `deployment_template_uri` (String) The URI of the deployment template to use. Only used if deployment_type is `CUSTOM`.
- `kubernetes` (Block List, Max: 1) The configuration details for Kubernetes deployments. (see [below for nested schema](#nestedblock--kubernetes))
- `kubernetes_gcp` (Block List, Max: 1) The configuration details for Kubernetes on GCP deployments. (see [below for nested schema](#nestedblock--kubernetes_gcp))
- `provisioner_name` (String) The name of the infrastructure provisioner to use.
- `scoped_services` (Set of String) The list of service names to scope this infrastructure definition to.
- `tanzu` (Block List, Max: 1) The configuration details for PCF deployments. (see [below for nested schema](#nestedblock--tanzu))

### Read-Only

- `id` (String) The unique id of the infrastructure definition.

<a id="nestedblock--aws_ami"></a>
### Nested Schema for `aws_ami`

Required:

- `ami_deployment_type` (String) The ami deployment type to use. Valid options are AWS_ASG, SPOTINST
- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `region` (String) The region to deploy to.

Optional:

- `asg_identifies_workload` (Boolean) Flag to indicate whether the autoscaling group identifies the workload.
- `autoscaling_group_name` (String) The name of the autoscaling group.
- `classic_loadbalancers` (Set of String) The classic load balancers to use.
- `hostname_convention` (String) The naming convention to use for the hostname. Defaults to ${host.ec2Instance.privateDnsName.split('\.')[0]}
- `spotinst_cloud_provider_name` (String) The name of the SpotInst cloud provider to connect with.
- `spotinst_config_json` (String) The SpotInst configuration to use.
- `stage_classic_loadbalancers` (Set of String) The staging classic load balancers to use.
- `stage_target_group_arns` (Set of String) The staging classic load balancers to use.
- `target_group_arns` (Set of String) The ARN's of the target groups.
- `use_traffic_shift` (Boolean) Flag to enable traffic shifting.


<a id="nestedblock--aws_ecs"></a>
### Nested Schema for `aws_ecs`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `cluster_name` (String) The name of the ECS cluster to use.
- `launch_type` (String) The type of launch configuration to use. Valid options are FARGATE
- `region` (String) The region to deploy to.

Optional:

- `assign_public_ip` (Boolean) Flag to assign a public IP address.
- `execution_role` (String) The ARN of the role to use for execution.
- `security_group_ids` (Set of String) The security group ids to apply to the ecs service.
- `subnet_ids` (Set of String) The subnet ids to apply to the ecs service.
- `vpc_id` (String) The VPC ids to use when selecting the instances.


<a id="nestedblock--aws_lambda"></a>
### Nested Schema for `aws_lambda`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `region` (String) The region to deploy to.

Optional:

- `iam_role` (String) The IAM role to use.
- `security_group_ids` (Set of String) The security group ids to apply to the ecs service.
- `subnet_ids` (Set of String) The subnet ids to apply to the ecs service.
- `vpc_id` (String) The VPC ids to use when selecting the instances.


<a id="nestedblock--aws_ssh"></a>
### Nested Schema for `aws_ssh`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `host_connection_type` (String) The type of host connection to use. Valid options are PRIVATE_DNS, PUBLIC_DNS, PRIVATE_IP, PUBLIC_IP
- `region` (String) The region to deploy to.

Optional:

- `autoscaling_group_name` (String) The name of the autoscaling group.
- `desired_capacity` (Number) The desired capacity of the auto scaling group.
- `host_connection_attrs_name` (String) The name of the host connection attributes to use.
- `hostname_convention` (String) The naming convention to use for the hostname. Defaults to ${host.ec2Instance.privateDnsName.split('\.')[0]}
- `loadbalancer_name` (String) The name of the load balancer to use.
- `tag` (Block Set) The tags to use when selecting the instances. (see [below for nested schema](#nestedblock--aws_ssh--tag))
- `vpc_ids` (Set of String) The VPC ids to use when selecting the instances.

<a id="nestedblock--aws_ssh--tag"></a>
### Nested Schema for `aws_ssh.tag`

Required:

- `key` (String) The key of the tag.
- `value` (String) The value of the tag.



<a id="nestedblock--aws_winrm"></a>
### Nested Schema for `aws_winrm`

Required:

- `autoscaling_group_name` (String) The name of the autoscaling group.
- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `host_connection_attrs_name` (String) The name of the host connection attributes to use.
- `host_connection_type` (String) The type of host connection to use. Valid options are PRIVATE_DNS, PUBLIC_DNS, PRIVATE_IP, PUBLIC_IP
- `region` (String) The region to deploy to.

Optional:

- `desired_capacity` (Number) The desired capacity of the autoscaling group.
- `hostname_convention` (String) The naming convention to use for the hostname. Defaults to ${host.ec2Instance.privateDnsName.split('\.')[0]}
- `loadbalancer_name` (String) The name of the load balancer to use.


<a id="nestedblock--azure_vmss"></a>
### Nested Schema for `azure_vmss`

Required:

- `auth_type` (String) The type of authentication to use. Valid options are SSH_PUBLIC_KEY.
- `base_name` (String) Base name.
- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `deployment_type` (String) The type of deployment. Valid options are NATIVE_VMSS
- `resource_group_name` (String) The name of the resource group.
- `subscription_id` (String) The unique id of the azure subscription.
- `username` (String) The username to connect with.

Optional:

- `host_connection_attrs_name` (String) The name of the host connection attributes to use.


<a id="nestedblock--azure_webapp"></a>
### Nested Schema for `azure_webapp`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `resource_group` (String) The name of the resource group.
- `subscription_id` (String) The unique id of the azure subscription.


<a id="nestedblock--custom"></a>
### Nested Schema for `custom`

Required:

- `deployment_type_template_version` (String) The template version

Optional:

- `variable` (Block Set) Variables to be used in the service (see [below for nested schema](#nestedblock--custom--variable))

<a id="nestedblock--custom--variable"></a>
### Nested Schema for `custom.variable`

Required:

- `name` (String) Name of the variable
- `value` (String) Value of the variable



<a id="nestedblock--datacenter_ssh"></a>
### Nested Schema for `datacenter_ssh`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `host_connection_attributes_name` (String) The name of the SSH connection attributes to use.
- `hostnames` (Set of String) A list of hosts to deploy to.


<a id="nestedblock--datacenter_winrm"></a>
### Nested Schema for `datacenter_winrm`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `hostnames` (Set of String) A list of hosts to deploy to.
- `winrm_connection_attributes_name` (String) The name of the WinRM connection attributes to use.


<a id="nestedblock--kubernetes"></a>
### Nested Schema for `kubernetes`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `namespace` (String) The namespace in Kubernetes to deploy to.
- `release_name` (String) The naming convention of the release. When using Helm Native the default is ${infra.kubernetes.infraId}. For standard Kubernetes manifests the default is release-${infra.kubernetes.infraId}


<a id="nestedblock--kubernetes_gcp"></a>
### Nested Schema for `kubernetes_gcp`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `cluster_name` (String) The name of the cluster being deployed to.
- `namespace` (String) The namespace in Kubernetes to deploy to.
- `release_name` (String) The naming convention of the release.


<a id="nestedblock--tanzu"></a>
### Nested Schema for `tanzu`

Required:

- `cloud_provider_name` (String) The name of the cloud provider to connect with.
- `organization` (String) The PCF organization to use.
- `space` (String) The PCF space to deploy to.

## Import

Import is supported using the following syntax:

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
# Import using the Harness application id, environment id, and infrastructure definition id
terraform import harness_infrastructure_definition.example <app_id>/<env_id>/<infradef_id>
```
